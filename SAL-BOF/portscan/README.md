# SmartPortScan - 智能端口扫描工具

## 功能特性

- ✅ TCP Connect 扫描
- ✅ CIDR 网段支持 (`192.168.1.0/24`)
- ✅ 三级扫描策略（快速/标准/完整）
- ✅ 自定义端口范围（`-p 70-90`, `-p 80,443,8080`）
- ✅ 批量并发扫描（8个端口/批次）
- ✅ 智能延迟控制（30ms/批次）
- ✅ 服务识别（自动匹配常见服务名）
- ✅ 优化性能（2秒超时）

## 使用方法

### 基本语法
```bash
smartscan <target> [options]
```

### 参数说明

- **target**: 目标IP地址或CIDR格式
  - 单个IP: `192.168.1.1`
  - CIDR格式: `192.168.1.0/24`
  - 支持IPv4地址范围

- **options**: 扫描选项（可选）
  - `1`: 快速扫描 (10个高优先级端口)
  - `2`: 标准扫描 (25个端口) **[默认]**
  - `3`: 完整扫描 (45个端口)
  - `-p <ports>`: 自定义端口（例如 `-p 80,443,22-25`）

### 使用示例

```bash
# 扫描单个主机（默认标准模式）
smartscan 192.168.1.1

# 扫描C段网络，标准模式
smartscan 192.168.1.0/24

# 快速扫描特定主机
smartscan 192.168.1.100 1

# 完整扫描
smartscan 192.168.1.1 3

# 自定义端口扫描 - 端口范围
smartscan 192.168.1.1 -p 70-90

# 自定义端口扫描 - 单个端口
smartscan 192.168.1.1 -p 8080

# 自定义端口 - 混合格式
smartscan 192.168.1.1 -p 80,443,22-25,3389
```

## 端口列表

### Level 1: 快速扫描 (10个端口)
```
Web服务: 80, 443, 8080, 8443
数据库: 1433, 1521, 3306, 5432, 6379, 27017
```
**适用场景**: 快速发现Web应用和数据库服务

### Level 2: 标准扫描 (25个端口) [默认]
```
Web服务: 80, 443, 8080, 8443
数据库: 1433, 1521, 3306, 5432, 6379, 27017
Windows: 135, 139, 445, 3389, 5985, 5986
Linux: 22
基础设施: 21, 25, 53, 110, 143, 993, 995, 23
```
**适用场景**: 标准扫描，区分Windows/Linux系统

### Level 3: 完整扫描 (45个端口)
```
包含Level 2所有端口 +
额外Web: 8000, 8888
额外数据库: 9200, 9300
域控: 88, 389, 636, 3268, 3269
其他服务: 7, 9, 13, 19, 37, 79, 113, 119
```
**适用场景**: 全面扫描所有常见服务

## 自定义端口格式

### 语法规则
- **单个端口**: `80`, `443`, `22`
- **端口范围**: `22-25`, `80-90`, `1000-2000`
- **逗号分隔**: `53,5985,5986`（多个独立端口）
- **混合格式**: `80,443,22-25,3389,8000-9000`

### 示例
```bash
# 扫描常见Web端口
smartscan 192.168.1.1 -p 80,443,8080,8443

# 扫描Windows服务端口
smartscan 192.168.1.1 -p 135,139,445,3389

# 扫描端口范围
smartscan 192.168.1.1 -p 20-25,80-90,443

# 复杂混合扫描
smartscan 192.168.1.1 -p 70-100,5980-5990,53
```

## 输出示例

```
[*] Starting port scan for: 192.168.1.100
[*] Scanning 25 ports
[*] Scanning 192.168.1.100...
  [+] Port 22 (ssh) - OPEN
  [+] Port 80 (http) - OPEN
  [+] Port 443 (https) - OPEN
  [+] Port 445 (smb) - OPEN
  [+] Port 3389 (rdp) - OPEN
[+] Host 192.168.1.100: 5 open ports found
[+] Scan completed. Found 5 open ports total.
```

## 技术规格

- **支持平台**: Windows (x64)
- **编译器**: MinGW-w64
- **依赖**: Winsock2, IP Helper API
- **内存使用**: ~7.3KB (BOF文件大小)
- **网络协议**: TCP
- **超时设置**: 2秒（优化性能）
- **批处理大小**: 8个端口（并发扫描）
- **批次延迟**: 30ms（平衡速度和隐蔽性）

## 性能优化

- **并发扫描**: 每批扫描8个端口，避免过快触发安全机制
- **智能延迟**: 批次间30ms延迟，平衡速度和隐蔽性
- **超时优化**: 2秒超时，提升扫描速度40-50%
- **资源控制**: 限制最大并发数，防止资源耗尽

## 安全注意事项

- ⚠️ 仅在获得授权的情况下使用
- ⚠️ 避免对生产系统进行完整扫描
- ⚠️ 监控系统资源使用情况
- ⚠️ 遵守网络安全最佳实践
- ⚠️ 端口扫描可能触发 IDS/IPS 告警

## 安装验证

```bash
# 确认BOF文件存在
ls -lh Extension-Kit/SAL-BOF/_bin/portscan.x64.o

# 确认AxScript加载
grep "smartscan" Extension-Kit/SAL-BOF/sal.axs

# 在beacon中测试命令
smartscan 127.0.0.1 1
```

## 版本历史

### v1.0.0 (2024-10-13)
- ✅ 初始版本实现
- ✅ TCP Connect 扫描
- ✅ CIDR 支持
- ✅ 三级扫描策略
- ✅ 自定义端口范围
- ✅ 批量并发优化
- ✅ 服务识别

## 许可证

本工具仅用于授权的安全测试和研究目的。

